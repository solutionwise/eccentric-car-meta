import{r as c,S as V,c as g,o as f,Q as B,F as C,m as S,a as v,t as w,x as $,R as A,T as R,b as I,k}from"./CXJKphkF.js";import{u as _}from"./B6j7ZqBZ.js";const E=["onClick","disabled"],M=["placeholder","disabled"],N={__name:"tags-input",props:{modelValue:{type:Array,default:()=>[]},placeholder:{type:String,default:"Add a tag..."},disabled:{type:Boolean,default:!1},containerClass:{type:String,default:""},maxTags:{type:Number,default:void 0},validateTag:{type:Function,default:()=>!0},addOnBlur:{type:Boolean,default:!0},duplicateTagBehavior:{type:String,default:"prevent",validator:o=>["prevent","allow","update"].includes(o)},trim:{type:Boolean,default:!0},caseSensitive:{type:Boolean,default:!1}},emits:["update:modelValue","tag:add","tag:remove","tag:update"],setup(o,{emit:h}){const e=o,i=h,d=c(),r=c(),l=c(""),u=()=>{var t;(t=r.value)==null||t.focus()},p=t=>{if(e.disabled)return;let a=e.trim?t.trim():t;if(!a)return;e.caseSensitive||(a=a.toLowerCase());const n=e.validateTag(a);if(n!==!0){console.warn(typeof n=="string"?n:"Invalid tag");return}if(e.maxTags&&e.modelValue.length>=e.maxTags)return;const s=e.modelValue.findIndex(m=>e.caseSensitive?m===a:m.toLowerCase()===a);if(s!==-1){if(e.duplicateTagBehavior==="prevent")return;if(e.duplicateTagBehavior==="update"){const m=[...e.modelValue];m[s]=a,i("update:modelValue",m),i("tag:update",a,s);return}}const y=[...e.modelValue,a];i("update:modelValue",y),i("tag:add",a)},b=t=>{if(e.disabled)return;const a=e.modelValue[t],n=e.modelValue.filter((s,y)=>y!==t);i("update:modelValue",n),i("tag:remove",a,t)},T=t=>{var a;if(!e.disabled)switch(t.key){case"Enter":t.preventDefault(),l.value&&(p(l.value),l.value="");break;case"Backspace":!l.value&&e.modelValue.length>0&&b(e.modelValue.length-1);break;case"Escape":l.value="",(a=r.value)==null||a.blur();break}},x=()=>{e.addOnBlur&&l.value&&(p(l.value),l.value="")};return V(()=>e.modelValue,()=>{},{deep:!0}),(t,a)=>(f(),g("div",{ref_key:"containerRef",ref:d,class:R(["flex flex-wrap gap-1 border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 rounded-md min-h-[40px]",o.containerClass]),onClick:u},[(f(!0),g(C,null,S(o.modelValue,(n,s)=>(f(),g("div",{key:`${n}-${s}`,class:"inline-flex items-center gap-1 rounded-md border border-transparent bg-secondary px-2 py-1 text-sm font-medium text-secondary-foreground ring-offset-background transition-colors hover:bg-secondary/80 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"},[v("span",null,w(n),1),v("button",{type:"button",class:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-secondary-foreground/20",onClick:$(y=>b(s),["stop"]),disabled:o.disabled},[...a[1]||(a[1]=[v("svg",{class:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[v("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,E)]))),128)),B(v("input",{ref_key:"inputRef",ref:r,"onUpdate:modelValue":a[0]||(a[0]=n=>l.value=n),type:"text",class:"flex-1 bg-transparent outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50 min-w-[120px]",placeholder:o.placeholder,disabled:o.disabled,onKeydown:T,onBlur:x},null,40,M),[[A,l.value]])],2))}},F={class:"space-y-3"},L={key:0,class:"text-sm text-gray-500"},D={key:1,class:"text-sm text-red-600"},z={__name:"TagManager",props:{imageId:{type:[String,Number],required:!0},initialTags:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},maxTags:{type:Number,default:void 0}},emits:["tags-updated"],setup(o,{emit:h}){const e=o,i=h,d=c([...e.initialTags]),r=c(!1),l=c(""),u=c(""),{apiCall:p}=_();V(()=>e.initialTags,t=>{d.value=[...t]},{deep:!0});const b=t=>!t||t.trim().length===0?"Tag cannot be empty":t.length>50?"Tag cannot be longer than 50 characters":/^[a-zA-Z0-9\s\-_]+$/.test(t)?!0:"Tag can only contain letters, numbers, spaces, hyphens, and underscores",T=async t=>{var a;if(!(e.disabled||r.value)){r.value=!0,l.value="Adding tag...",u.value="";try{const n=await p(`/api/images/${e.imageId}/tags`,{method:"POST",body:{tag:t}});d.value=n.tags||[],i("tags-updated",d.value)}catch(n){u.value=((a=n.data)==null?void 0:a.error)||"Failed to add tag",console.error("Add tag error:",n),d.value=[...e.initialTags]}finally{r.value=!1,l.value=""}}},x=async(t,a)=>{var n;if(!(e.disabled||r.value)){r.value=!0,l.value="Removing tag...",u.value="";try{const s=await p(`/api/images/${e.imageId}/tags/${encodeURIComponent(t)}`,{method:"DELETE"});d.value=s.tags||[],i("tags-updated",d.value)}catch(s){u.value=((n=s.data)==null?void 0:n.error)||"Failed to remove tag",console.error("Remove tag error:",s),d.value=[...e.initialTags]}finally{r.value=!1,l.value=""}}};return(t,a)=>(f(),g("div",F,[I(N,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=n=>d.value=n),placeholder:"Add a tag...",disabled:o.disabled||r.value,"onTag:add":T,"onTag:remove":x,"validate-tag":b,"max-tags":o.maxTags,"duplicate-tag-behavior":"prevent",trim:""},null,8,["modelValue","disabled","max-tags"]),r.value?(f(),g("div",L,w(l.value),1)):k("",!0),u.value?(f(),g("div",D,w(u.value),1)):k("",!0)]))}};export{z as _};
